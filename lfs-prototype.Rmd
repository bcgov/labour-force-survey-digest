---
title: "Labour Force Survey: British Columbia"
output: 
  flexdashboard::flex_dashboard:
    theme: yeti
    orientation: rows
    vertical_layout: scroll
    social: menu
    source_code: https://github.com/bcgov/labour-force-survey-digest
---


<!--
Copyright 2020 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
-->


```{r setup, include=FALSE, cache=TRUE}
##load libraries in setup.R
source("setup.R")

##source data
##source("get-data.R")
lfc_province_tidy <- readRDS("tmp/lfc_province_tidy.rds")
lfc_region_tidy <- readRDS("tmp/lfc_region_tidy.rds")
employment_by_class_tidy <- readRDS("tmp/employment_by_class_tidy.rds")
can_provinces <- readRDS("tmp/can_provinces.rds")

##report month
report_month <- lfc_province_tidy %>%
  filter(vector == "v2064705",
         date == max(date)) %>%
  pull(date) %>%
  month(label = TRUE, abbr = FALSE)

##report year
report_year <- lfc_province_tidy %>%
  filter(vector == "v2064705",
         date == max(date)) %>%
  pull(date) %>%
  year()

##previous report year
previous_year <- report_year - 1


##common chart themes
theme_bar <- theme(
  axis.line = element_line(colour = "grey70", size = .1),
  axis.text = element_text(size = 9),
  legend.text = element_text(size = 11, colour = "grey20")
)

theme_vert_bar <- theme_bar +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank()
  )

theme_horiz_bar <- theme_bar +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  )

theme_facet_bar <- theme_vert_bar +
  theme(
    axis.text.y = element_text(size = 9),
    axis.text.x = element_text(size = 8),
    strip.text = element_text(size = 11, colour = "grey20"),
    legend.text = element_text(size = 11, colour = "grey20")
  )

##colours
main_colour <- "#1d91c0"

##labels
gender_labels <-  c("Males" = "Men",
                    "Females" = "Women")

##custom ggplotly
ggplotly_lfs <- function(...) {
  ggplotly(..., tooltip = c("text"))
}
```


Sidebar {.sidebar}
=======================================================================


## `r paste(report_month, report_year)`

<br>

Labour Force Survey Summary for British Columbia:

 - [Highlights]
 - [Demographics]
 - [Sector & Job Type]
 - [Industry]
 - [COVID-19 Recovery]

<br>

ðŸ–± Click or tap on graphs for interactive options:

![](images/plotly-options.png){width=90%}

<br>

Learn more [About] the Statistics Canada Labour Force Survey.


Highlights
======================================================================


Row 1
----------------------------------------------------------------------

### B.C. Unemployment Rate for Recent Month {.value-box}

```{r}
##recent month unemployment rate
recent_month_unemployment_rate_bc <- lfc_province_tidy %>%
  filter(
    vector == "v2064705",
    date == max(date)
  )

valueBox(
  value = recent_month_unemployment_rate_bc %>%
    pull(value) %>%
    signs(format = percent, accuracy = 0.1),
  # icon = "fa-users-cog",
  caption = paste("B.C. Unemployment Rate for", report_month, report_year)
)
```

### Month-Over-Month Change in B.C. Unemployment Rate {.value-box}

```{r}
valueBox(
  value = recent_month_unemployment_rate_bc %>%
    pull(month_change) %>%
    signs(format = percent, accuracy = 0.1),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in B.C. Unemployment Rate"
)
```

### Year-Over-Year Change in B.C. Unemployment Rate {.value-box}

```{r}
##year over year change unemployment rate
year_change_unemployment_rate_bc <- lfc_province_tidy %>%
  filter(
    vector == "v2064705",
    date %in% c(max(date) - months(12), max(date))
  ) %>%
  mutate(year_change = value - lag(value)) %>%
  filter(date == max(date))

valueBox(
  value = year_change_unemployment_rate_bc %>%
    pull(year_change) %>%
    signs(
      format = percent,
      add_plusses = TRUE,
      accuracy = 0.1
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in B.C. Unemployment Rate")
)
```


Row 2
----------------------------------------------------------------------

### Monthly B.C. Unemployment Rates Since 2000 

```{r, fig.width=7, fig.height=5}
unemployrt_pre_thisyear <- lfc_province_tidy %>%
  filter(vector == "v2064705",
         date > "1999-12-31" & date < paste0(report_year, "-01-01"))

unemployrt_thisyear <- lfc_province_tidy %>%
  filter(vector == "v2064705",
         date >= paste0(report_year, "-01-01"))

ggplotly_lfs(
  ggplot() +
  geom_point(
    data = unemployrt_thisyear,
    aes(
      x = date,
      y = value,
      text = paste0(
        "Date: ",
        date,
        "<br>",
        "Unemployment Rate: ",
        signs(value,
              format = percent,
              accuracy = 0.1)
      )
    ),
    colour = main_colour,
    alpha = 0.8
  ) +
  geom_point(
    data = unemployrt_pre_thisyear,
    aes(
      x = date,
      y = value,
      text = paste(
        "Date:",
        date,
        "<br>",
        "Unemployment Rate:",
        signs(value,
              format = percent,
              accuracy = 0.1)
      )
    ),
    colour = "grey50",
    alpha = 0.8
  ) +
  geom_line(
    data = unemployrt_thisyear,
    aes(x = date,
        y = value),
    colour = main_colour,
    alpha = 0.8
  ) +
  geom_line(
    data = unemployrt_pre_thisyear,
    aes(x = date,
        y = value),
    colour = "grey50",
    alpha = 0.8
  ) +
  labs(x = NULL, y = NULL) +
  scale_y_continuous(labels = percent,
                     breaks = breaks_pretty(n = 6)) +
  theme_minimal() +
  theme_vert_bar
)
```

### Unemployment Rates by B.C. Economic Region for `r paste(report_month, report_year)` 

```{r, fig.width=7, fig.height=5}
# ggplotly_lfs(
  lfc_region_tidy %>%
    filter(
      geo != "British Columbia",
      labour_force_characteristics == "Unemployment rate",
      date == max(date)
    ) %>%
    mutate(geo_label = str_wrap(str_extract(geo, "^([^,])+"), width = 10)) %>%
    ggplot() +
    geom_sf(
      aes(
        fill = value,
        text = paste0(
          "Region: ",
          geo_label,
          "<br>",
          "Date: ",
          date,
          "<br>",
          "Unemployment Rate: ",
          signs(value,
                format = percent,
                accuracy = 0.1)
        )
      ),
      colour = "white",
      lwd = .2
    ) +
    geom_sf_text(aes(label = geo_label),
                 size = 3.5,
                 colour = "grey20") +
    # coord_sf(datum = NA) +
    labs(x = NULL, y = NULL,
         caption = "(3-month-moving-avg, seasonally unadjusted)") +
    scale_fill_viridis(
      name = paste(report_month,
                   report_year,
                   "\nUnemployment\nRate"),
      direction = -1,
      begin = 0.3,
      end = 1,
      labels = percent_format(accuracy = 1),
      breaks = breaks_pretty(n = 5)
    ) +
    theme_minimal() +
    theme(
      legend.title = element_text(size = 11,
                                  colour = "grey20"),
      legend.text = element_text(size = 10,
                                 colour = "grey20"),
      plot.caption = element_text(
        size = 8,
        colour = "grey60",
        face = "italic",
        hjust = 1.3
      ),
      panel.grid.major = element_line(colour = "transparent"),
      axis.text = element_blank()
    )
# )
```


Row 3
---------------------------------------------------------------------------

### Number of Jobs in B.C. {.value-box}

```{r}
# recent month employment
recent_month_employment_bc <- lfc_province_tidy %>%
  filter(
    vector == "v2064701",
    date == max(date)
  )

valueBox(
  value = recent_month_employment_bc %>%
    pull(value) %>%
    signs(format = comma),
  # icon = "fa-users-cog",
  caption = paste("Number of Jobs in B.C. for", report_month, report_year)
)
```

### Month-Over-Month Change in Number of Jobs in B.C. {.value-box}

```{r}
valueBox(
  value = recent_month_employment_bc %>%
    pull(month_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    ),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in Number of Jobs in B.C."
)
```

### Year-Over-Year Change in Number of Jobs in B.C. {.value-box}

```{r}
year_change_employment_bc <- lfc_province_tidy %>%
  filter(
    vector == "v2064701",
    date %in% c(max(date) - months(12), max(date))
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))

# year over year change employment
valueBox(
  value = year_change_employment_bc %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Jobs in B.C.")
)
```


Row 4
---------------------------------------------------------------------

### Month-Over-Month Change in Number of Jobs in B.C. for `r report_year` 

```{r, fig.width=7, fig.height=5}
ggplotly_lfs(
  lfc_province_tidy %>%
  filter(
    vector == "v2064701",
    date >= paste0(report_year, "-01-01")
  ) %>%
  {
    ggplot(
      .,
      aes(
        x = date,
        y = month_change,
        text = paste0(
          "Number of Jobs: ",
          signs(
            value,
            format = comma
          ),
          "<br>",
          "Month-Over-Month Change: ",
          signs(
            month_change,
            format = comma,
            add_plusses = TRUE
          ),
          "<br>",
          "% Month-Over-Month Change: ",
          signs(
            month_change_percent,
            format = percent,
            add_plusses = TRUE,
            accuracy = 0.1
          )
        )
      )
    ) +
      geom_col(
        fill = main_colour,
        alpha = 0.6
      ) +
      geom_text(
        aes(
          label = signs(
            month_change,
            format = comma,
            add_plusses = TRUE
          )
        ),
        nudge_y = ifelse(.$month_change > 0, 10000, -10000),
        colour = "grey20",
        size = 2.5
      ) +
      labs(
        x = NULL,
        y = NULL
      ) +
      scale_y_continuous(
        labels = comma,
        breaks = breaks_pretty(n = 8)
      ) +
      scale_x_date(breaks = breaks_pretty(n = 8)) +
      theme_minimal() +
      theme_vert_bar
  }
)
```


### Month-Over-Month Percent Change in Number of Jobs by B.C. Economic Region for `r paste(report_month, report_year)`

```{r, fig.width=7, fig.height=5}
# ggplotly_lfs(
  lfc_region_tidy %>%
    filter(
      geo != "British Columbia",
      labour_force_characteristics == "Employment",
      date == max(date)
    ) %>%
    mutate(geo_label = str_wrap(str_extract(geo, "^([^,])+"), width = 10)) %>%
    ggplot() +
    geom_sf(
      aes(
        fill = month_change_percent),
      colour = "white",
      lwd = .2
    ) +
    geom_sf_text(aes(label = geo_label),
                 size = 3.5,
                 colour = "grey20") +
    labs(x = NULL, y = NULL,
         caption = "(3-month-moving-avg, seasonally unadjusted)") +
    scale_fill_viridis(
      name = paste(report_month,
                   report_year,
                   "\n% Change\nin Number\nof Jobs"),
      direction = -1,
      begin = 0.3,
      end = 1,
      labels = percent_format(accuracy = 1),
      breaks = breaks_pretty(n = 3)
    ) +
    theme_minimal() +
    theme(
      legend.title = element_text(size = 11,
                                  colour = "grey20"),
      legend.text = element_text(size = 10,
                                 colour = "grey20"),
      plot.caption = element_text(
        size = 8,
        colour = "grey60",
        face = "italic",
        hjust = 1.3
      ),
      panel.grid.major = element_line(colour = "transparent"),
      axis.text = element_blank()
    )
# )
```


Row 5
-----------------------------------------------------------------------

### CAN Unemployment Rate (%) for Recent Month {.value-box}

```{r}
#recent monthly change in unemployment for CAN
month_unemployment_rate_can <- lfc_province_tidy %>%
  filter(vector == "v2062815",
         date == max(date))

valueBox(
  value = month_unemployment_rate_can %>%
    pull(value) %>%
    signs(format = percent, accuracy = 0.1),
  # icon = "fa-users-cog",
  caption = paste("Canada Unemployment Rate in", report_month)
)
```


### Month-Over-Month Change in Canada Unemployment Rate {.value-box}

```{r}
#recent monthly change in unemployment for CAN
valueBox(
  value = month_unemployment_rate_can %>%
    pull(month_change) %>%
    signs(format = percent, accuracy = 0.1),
  # icon = "fa-users-cog",
  caption = paste("Month-Over-Month Change in Canada Unemployment Rate")
)
```

### Year-Over-Year Change in Canada Unemployment Rate {.value-box}

```{r}
#CAN year over year change unemployment rate
year_change_unemployment_rate_can <- lfc_province_tidy %>%
  filter(vector == "v2062815",
  date %in% c(max(date) - months(12), max(date))) %>% 
  mutate(year_change = value - lag(value)) %>% 
  filter(date == max(date))

valueBox(
  value = year_change_unemployment_rate_can %>%
    pull(year_change) %>%
    signs(
      format = percent,
      add_plusses = TRUE,
      accuracy = 0.1
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Canada Unemployment Rate")
)
```


Row 6
---------------------------------------------------------------------------


### Unemployment Rate for `r paste(report_month, report_year)` by Province

```{r, fig.width=7, fig.height=5}
unemploy_rt_provinces <- lfc_province_tidy %>%
  filter(
    labour_force_characteristics == "Unemployment rate",
    sex == "Both sexes",
    age_group == "15 years and over",
    date == max(date),
    geo != "Canada")

unemploy_rt_provinces_spatial <-  can_provinces %>% 
  left_join(unemploy_rt_provinces, by = c("name"= "geo"))

# ggplotly_lfs(
  ggplot(unemploy_rt_provinces_spatial) +
  geom_sf(aes(fill = value, 
              text = paste0(report_month," ",report_year,"\n",
                            name,"\n","Unemployment Rate: ",
                            signs(value,
            format = percent,
            accuracy = 0.1)
    ))) +
   labs(x = NULL, y = NULL) +
  scale_fill_viridis(
    name = paste(report_month,
                 report_year,
                 "\nUnemployment\nRate"),
    direction = -1,
    begin = 0.3,
    end = 1,
    labels = percent_format(accuracy = 1),
    breaks = breaks_pretty(n = 5),
    na.value="white"
  ) +
  theme_minimal() +
  theme(
    legend.title = element_text(size = 11, 
                                colour = "grey20"),
    legend.text = element_text(size = 10,
                               colour = "grey20"),
    plot.caption = element_text(
      size = 8,
      colour = "grey60",
      face = "italic",
      hjust = 1.3
    ),
    panel.grid.major = element_line(colour = "transparent"),
    axis.text = element_blank()
  )
  # )
```

### Monthly Unemployment Rates by Province for `r report_year`

```{r, fig.width=7, fig.height=5}
prov_acronyms <- tribble(
  ~geo, ~acronym,
  "British Columbia", "BC",
  "Alberta", "AB",
  "Saskatchewan", "SK",
  "Newfoundland and Labrador", "NL",
  "Prince Edward Island", "PE",
  "Nova Scotia", "NS",       
  "New Brunswick", "NB",       
  "Quebec", "QC",               
  "Ontario", "ON",
  "Manitoba", "MB"
)

unemploy_rt_provinces_report_year <-  lfc_province_tidy %>%
  filter(
    labour_force_characteristics == "Unemployment rate",
    sex == "Both sexes",
    age_group == "15 years and over",
    geo != "Canada",
    date >= paste0(report_year, "-01-01")
) %>% 
 mutate(fill_col = ifelse(geo == "British Columbia", "bc", "other")) %>% 
  left_join(prov_acronyms)


p <- unemploy_rt_provinces_report_year %>% 
 ggplot(aes(
    x = date,
    y = value,
    group = geo
  )) +
  geom_point(aes(colour = fill_col,
                 text = paste0(
      "Province: ",
      geo,
      "<br>",
      "Date: ",
      date,
      "<br>",
      "Unemployment Rate: ",
      signs(value,
            format = percent)
    )),
    alpha = 0.6) +
  geom_line(alpha = 0.8, colour = main_colour) +
  geom_line(data = unemploy_rt_provinces_report_year %>% filter(acronym == "BC"), 
            alpha = 0.8, size = 1.5, colour = "#440154FF") +
  geom_text(data = unemploy_rt_provinces_report_year %>% filter(date == max(date)),
            aes(label = acronym,
                x = date,
                y = value,
                colour = fill_col),
                nudge_x = 8
            ) +
  labs(x = NULL,
       y = NULL) +
  scale_y_continuous(labels = percent,
                     breaks = breaks_pretty(n = 6)) +
  scale_colour_manual(guide = FALSE,
                      values = c(bc = "#440154FF",
                               other = main_colour)) +
  scale_x_date(breaks = breaks_pretty(n = 8)) +
  scale_size(range= c(6, 1)) +
  theme_minimal() +
  theme_vert_bar +
  theme(legend.position = "none")

ggplotly_lfs(p)
```


```{r, include=FALSE}
### Number of Jobs in Canada in August {.value-box}

#recent monthly change in CAN employment
month_change_employment_can <- lfc_province_tidy %>%
  filter(vector == "v2062811",
         date == max(date))

valueBox(
  value = month_change_employment_can %>%
    pull(value) %>%
    signs(format = comma),
  # icon = "fa-users-cog",
  caption = paste("Number of Jobs in Canada in", report_month)
)
```


```{r, include=FALSE}
### Month-Over-Month Change in Number of Jobs in Canada {.value-box}

#recent monthly change in CAN employment
valueBox(
  value = month_change_employment_can %>%
    pull(month_change) %>%
    signs(format = comma,
          add_plusses = TRUE),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in Number of Jobs in Canada"
)
```


```{r, include=FALSE}
### Year-Over-Year Change in Number of Jobs in Canada {.value-box}

year_change_employment_can <- lfc_province_tidy %>%
  filter(vector == "v2062811",
         date %in% c(max(date) - months(12), max(date))) %>% 
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>% 
  filter(date == max(date))

#year over year change employment
valueBox(value = year_change_employment_can %>% 
  pull(year_change) %>%
  signs(format = comma,
        add_plusses = TRUE),
         # icon = "fa-users-cog",
         caption = paste("Year-Over-Year Change in Number of Jobs in Canada"))
```


Demographics
=========================================================================

Row 1
----------------------------------------------------------------------------


### Women B.C. Unemployment Rate (Aged 25 Years & Over) {.value-box}

```{r}
#bc unemployment rate - females
recent_month_unemployment_rate_bc_female <- lfc_province_tidy %>%
  filter(vector == "v2064831",
         date == max(date))

valueBox(paste0("Women: ",
  value = recent_month_unemployment_rate_bc_female %>%
    pull(value) %>%
    signs(format = percent, accuracy = 0.1)),
  # icon = "fa-users-cog",
  caption = paste("B.C. Unemployment Rate for Women (25 Years & Over) for", report_month, report_year)
)
```

### Women Month-Over-Month Change in Recent B.C. Unemployment Rate {.value-box}

```{r}
valueBox(
  value = recent_month_unemployment_rate_bc_female %>%
    pull(month_change) %>%
    signs(format = percent, accuracy = 0.1),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in B.C. Unemployment Rate for Women"
)
```


### Women Year-Over-Year Change in Recent B.C. Unemployment Rate {.value-box}

```{r}
##year over year change unemployment rate female
year_change_unemployment_rate_bc_female <- lfc_province_tidy %>%
  filter(vector == "v2064831",
         date %in% c(max(date) - months(12), max(date))
  ) %>%
  mutate(year_change = value - lag(value)) %>%
  filter(date == max(date))

valueBox(
  value = year_change_unemployment_rate_bc_female %>%
    pull(year_change) %>%
    signs(
      format = percent,
      add_plusses = TRUE,
      accuracy = 0.1
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in B.C. Unemployment Rate for Women")
)
```


Row 2
----------------------------------------------------------------


### Men B.C. Unemployment Rate (Aged 25 Years & Over) {.value-box}

```{r}
#unemployment rate - males
recent_month_unemployment_rate_bc_male <- lfc_province_tidy %>%
  filter(vector == "v2064822",
         date == max(date))

valueBox(
  value = paste0("Men: ",
                 recent_month_unemployment_rate_bc_male %>%
    pull(value) %>%
    signs(format = percent, accuracy = 0.1)),
  # icon = "fa-users-cog",
  caption = paste("B.C. Unemployment Rate for Men (25 Years & Over) for", report_month, report_year)
)
```


### Men Month-Over-Month Change in Recent B.C. Unemployment Rate {.value-box}

```{r}
valueBox(
  value = recent_month_unemployment_rate_bc_male %>%
    pull(month_change) %>%
    signs(format = percent, accuracy = 0.1),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in B.C. Unemployment Rate for Men"
)
```

### Men Year-Over-Year Change in Recent B.C. Unemployment Rate {.value-box}

```{r}
##year over year change unemployment rate bc males
year_change_unemployment_rate_bc_male <- lfc_province_tidy %>%
  filter(
    vector == "v2064822",
    date %in% c(max(date) - months(12), max(date))
  ) %>%
  mutate(year_change = value - lag(value)) %>%
  filter(date == max(date))

valueBox(
  value = year_change_unemployment_rate_bc_male %>%
    pull(year_change) %>%
    signs(
      format = percent,
      add_plusses = TRUE,
      accuracy = 0.1
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in B.C. Unemployment Rate for Men")
)
```


Row 3
-----------------------------------------------------------------------

### Monthly B.C. Unemployment Rates by Gender (Ages 25 Years & Over) Since 2000

```{r, fig.width=7, fig.height=5}
ggplotly_lfs(
lfc_province_tidy %>%
  filter(
    date > "1999-12-01",
    geo == "British Columbia",
    labour_force_characteristics %in% c("Unemployment rate"),
    age_group %in% c("25 years and over"
                     # "15 to 24 years",
                     # "25 to 54 years",
                     # "55 years and over"
                     ),
    sex != "Both sexes"
  ) %>% 
  mutate(highlight = case_when(date >= paste0(report_year, "-01-01") ~ "thisyear",
                               TRUE ~ "preyears")) %>% 
  ggplot(aes(
    x = date,
    y = value,
    colour = highlight
  )) +
  geom_point(aes(text = paste0(
      "Date: ",
      date,
      "<br>",
      "Age Group: ",
      age_group,
      "<br>",
      "Unemployment Rate: ",
      signs(value,
            format = percent,
            accuracy = 0.1)
    )),
    alpha = 0.6) +
  geom_line(alpha = 0.8) +
  facet_wrap(facets = vars(sex),
             labeller = as_labeller(gender_labels)) +
  labs(x = NULL,
       y = NULL) +
  scale_y_continuous(labels = percent,
                     breaks = breaks_pretty(n = 6)) +
  scale_colour_manual(guide = FALSE,
                  values = c(preyears = "grey50",
                               thisyear = main_colour)) +
  scale_x_date(breaks = breaks_pretty(n = 6)) +
  theme_minimal() +
  theme_facet_bar +
  theme(legend.position = "none")
)
```

Row 4
-------------------------------------------------------------------

### Women Number of Jobs (Aged 25 Years & Over) in B.C. {.value-box}

```{r}
recent_month_employment_bc_female <- lfc_province_tidy %>%
  filter(
    vector == "v2064827",
    date == max(date)) 

valueBox(
  value = paste0("Women: ",
                 recent_month_employment_bc_female %>%
    pull(value) %>%
    signs(format = comma)),
  # icon = "fa-users-cog",
  caption = paste("Number of Jobs for Women (25 Years & Over) in B.C. for", report_month, report_year)
)
```


### Women Month-Over-Month Change in Number of Jobs (Aged 25 Years & Over) in B.C. {.value-box}

```{r}
valueBox(
  value = recent_month_employment_bc_female %>%
    pull(month_change) %>%
    signs(format = comma,
            add_plusses = TRUE),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in Number of Jobs for Women in B.C."
)
```


### Women Year-Over-Year Change in Number of Jobs (Aged 25 Years & Over) in B.C. {.value-box}

```{r}
year_change_employment_bc_female <- lfc_province_tidy %>%
  filter(
    vector == "v2064827",
    date %in% c(max(date) - months(12), max(date))
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))

# year over year change employment
valueBox(
  value = year_change_employment_bc_female %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Jobs for Women in B.C.")
)
```

Row 5
----------------------------------------------------------------------

### Men Number of Jobs for (Aged 25 Years & Over) in B.C. {.value-box}}

```{r}
#recent month employment males
recent_month_employment_bc_male <- lfc_province_tidy %>%
  filter(vector == "v2064818",
    date == max(date))

valueBox(
  value = paste0("Men: ",
                 recent_month_employment_bc_male %>%
    pull(value) %>%
    signs(format = comma)),
  # icon = "fa-users-cog",
  caption = paste("Number of Jobs for Men (25 Years & Over) in B.C. for", report_month, report_year)
)
```


### Men Month-Over-Month Change in Number of Jobs in B.C. (Aged 25 Years & Over) in B.C. {.value-box}

```{r}
valueBox(
  value = recent_month_employment_bc_male %>%
    pull(month_change) %>%
    signs(format = comma,
            add_plusses = TRUE),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in Number of Jobs for Men in B.C."
)
```

### Men Year-Over-Year Change in Number of Jobs (Aged 25 Years & Over) in B.C. {.value-box}

```{r}
year_change_employment_bc_male <- lfc_province_tidy %>%
  filter(
    vector == "v2064818",
    date %in% c(max(date) - months(12), max(date))
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))

# year over year change employment
valueBox(
  value = year_change_employment_bc_male %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Jobs for Men in B.C.")
)
```


Row 6
----------------------------------------------------------------------------

### Month-Over-Month Change in Number of Jobs in B.C. by Gender (Ages 25 Years & Over) for `r report_year` 

```{r, fig.width=7, fig.height=5}
ggplotly_lfs(
  lfc_province_tidy %>%
  filter(
    date >= paste0(report_year, "-01-01"),
    geo == "British Columbia",
    labour_force_characteristics == "Employment",
    age_group == "25 years and over",
    sex != "Both sexes"
  ) %>% 
    {
  ggplot(data = .,
         aes(
    x = date,
    y = month_change,
    text = paste0(
      "Number of Jobs: ",
      signs(value,
            format = comma),
      "<br>",
      "Month-Over-Month Change: ",
      signs(month_change,
            format = comma,
            add_plusses = TRUE),
      "<br>",
      "% Month-Over-Month Change: ",
      signs(
        month_change_percent,
        format = percent,
        add_plusses = TRUE,
        accuracy = 0.1
      )
    )
         )) +
  geom_col(fill = main_colour,
           alpha = 0.6) +
  facet_wrap(~sex,
             labeller = as_labeller(gender_labels)) +
  geom_text(
    aes(
      label = signs(
        month_change,
        format = comma,
        add_plusses = TRUE
      )
    ),
    nudge_y = ifelse(.$month_change > 0, 3000, -3000),
    colour = "grey20",
    size = 2
  ) +
  labs(x = NULL,
       y = NULL) +
  scale_y_continuous(labels = comma,
                     breaks = breaks_pretty(8)) +
  scale_x_date(breaks = breaks_pretty(n = 8)) +
  theme_minimal() +
  theme_facet_bar
# theme(strip.text.y = element_text(angle = 0))
  }
)
```


Row 7
-----------------------------------------------------------------------------


### Youth B.C. Unemployment Rate (Aged 15 to 25 Years) {.value-box}

```{r}
#monthly unemployment rate - youth
valueBox(
  value = paste0("Youth: ",
                 lfc_province_tidy %>%
  filter(vector == "v2064732",
         date == max(date)) %>%
    pull(value) %>%
    signs(format = percent, accuracy = 0.1)),
  # icon = "fa-users-cog",
  caption = paste("B.C. Unemployment Rate for Youth (15 to 24 Years) for", report_month, report_year)
)
```

	


### Youth Month-Over-Month Change in Number of Jobs (Aged 15 to 24 Years) in B.C.   {.value-box}

```{r}
valueBox(
  value = lfc_province_tidy %>%
  filter(vector == "v2064728",
         date == max(date)) %>%
    pull(month_change) %>%
    signs(format = comma,
            add_plusses = TRUE),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in Number of Jobs for Youth in B.C."
)
```


### Youth Year-Over-Year Change in Number of Jobs (Aged 15 to 24 Years) in B.C. {.value-box}

```{r}
year_change_employment_bc_youth <- lfc_province_tidy %>%
  filter(
    vector == "v2064728",
    date %in% c(max(date) - months(12), max(date))
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))

# year over year change employment
valueBox(
  value = year_change_employment_bc_youth %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Jobs for Youth in B.C.")
)
```


Row 8
-----------------------------------------------------------------------------

### Monthly B.C. Unemployment Rates by Age & Gender for `r report_year`

```{r, fig.width=7, fig.height=5}
ggplotly_lfs(
lfc_province_tidy %>%
  filter(
    date > "2019-12-01",
    geo == "British Columbia",
    labour_force_characteristics %in% c("Unemployment rate"),
    age_group %in% c(
                     "15 to 24 years",
                     "25 to 54 years",
                     "55 years and over"
                     ),
    sex != "Both sexes"
  ) %>% 
  ggplot(aes(
    x = date,
    y = value,
    colour = age_group
  )) +
  geom_point(aes(text = paste0(
      "Date: ",
      date,
      "<br>",
      "Gender: ",
      sex,
      "<br>",
      "Age Group: ",
      age_group,
      "<br>",
      "Unemployment Rate: ",
      signs(value,
            format = percent,
            accuracy = 0.1)
    )),
    alpha = 0.6) +
  geom_line(alpha = 0.8) +
  facet_wrap(facets = vars(sex),
             labeller = as_labeller(gender_labels)) +
  labs(x = NULL,
       y = NULL) +
  scale_y_continuous(labels = percent,
                     breaks = breaks_pretty(n = 6)) +
  scale_colour_viridis_d(name = NULL) +
  scale_x_date(breaks = breaks_pretty(n = 4)) +
  theme_minimal() +
  theme_facet_bar 
) %>%
  layout(legend = list(
    orientation = "h",
    x = 0.15,
    y = -0.2
  ))

```

### Youth Month-Over-Month Change in Number of Jobs in B.C. (15 to 24 Years) by Gender in `r report_year` 

```{r, fig.width=7, fig.height=5}

##labels
gender_labels_youth <-  c("Males" = "Youth: Men",
                          "Females" = "Youth: Women")
ggplotly_lfs(
  lfc_province_tidy %>%
  filter(
    date >= paste0(report_year, "-01-01"),
    geo == "British Columbia",
    labour_force_characteristics == "Employment",
    age_group == "15 to 24 years",
    sex != "Both sexes"
  ) %>%
    {
  ggplot(data = .,
         aes(
    x = date,
    y = month_change,
   text = paste0(
      "Number of Jobs: ",
      signs(value,
            format = comma),
      "<br>",
      "Month-Over-Month Change: ",
      signs(month_change,
            format = comma,
            add_plusses = TRUE),
      "<br>",
      "% Month-Over-Month Change: ",
      signs(
        month_change_percent,
        format = percent,
        add_plusses = TRUE,
        accuracy = 0.1
      )
    )
  )) +
  geom_col(fill = main_colour,
           alpha = 0.6) +
  facet_wrap(facets = vars(sex),
             labeller = as_labeller(gender_labels_youth)) +
  geom_text(
    aes(
      label = signs(
        month_change,
        format = comma,
        add_plusses = TRUE
      )
    ),
    nudge_y = ifelse(.$month_change > 0, 1500, -1500),
    colour = "grey20",
    size = 2
  ) +
  labs(x = NULL,
       y = NULL) +
  scale_y_continuous(labels = comma,
                     breaks = breaks_pretty(5)) +
  scale_x_date(breaks = breaks_pretty(n = 4)) +
  theme_minimal() +
  theme_facet_bar
}
)
```

Sector & Job Type
===================================================================

Row 1
------------------------------------------------------------------

### Private Sector Month-Over-Month Change in Number of Jobs in B.C. {.value-box}

```{r}
month_employment_bc_jobtype <- employment_by_class_tidy %>%
  filter(
    class_of_worker %in% c(
      "Public sector employees",
      "Private sector employees",
      "Self-employed"
    ),
   date == max(date)
  ) %>%
  mutate(class_of_worker = recode(class_of_worker,
                                  "Public sector employees" = "Public Sector",
                                  "Private sector employees" = "Private Sector",
                                  "Self-employed" = "Self-employed"))

valueBox(
  value = paste0("Private Sector: ",
                 month_employment_bc_jobtype %>%
                   filter(class_of_worker == "Private Sector") %>% 
    pull(month_change) %>%
    signs(format = comma,
          add_plusses = TRUE)),
  caption = paste("Month-Over-Month Change in Number of Private Sector Jobs in B.C. for", report_month, report_year)
)
```


### Public Sector Month-Over-Month Change in Number of Jobs in B.C. {.value-box}

```{r}
valueBox(
  value = paste0("Public Sector: ",
                 month_employment_bc_jobtype %>%
                   filter(class_of_worker == "Public Sector") %>% 
    pull(month_change) %>%
    signs(format = comma,
          add_plusses = TRUE)),
  caption = paste("Month-Over-Month Change in Number of Public Sector Jobs in B.C. for", report_month, report_year)
)
```

### Self-employed Month-Over-Month Change in Number of Jobs in B.C. {.value-box}

```{r}
valueBox(
  value = paste0("Self-employed: ",
                 month_employment_bc_jobtype %>%
                   filter(class_of_worker == "Self-employed") %>% 
    pull(month_change) %>%
    signs(format = comma,
          add_plusses = TRUE)),
  caption = paste("Month-Over-Month Change in Number of Self-employed Jobs in B.C. for", report_month, report_year)
)
```


Row 2
----------------------------------------------------------------

### Change in Number of Jobs in B.C. by Sector for `r report_year` 

```{r, fig.width=7, fig.height=5}
ggplotly_lfs(
  employment_by_class_tidy %>%
  filter(
    class_of_worker %in% c(
      "Public sector employees",
      "Private sector employees",
      "Self-employed"),
    date >= paste0(report_year, "-01-01")
  ) %>%
  mutate(class_of_worker = recode(class_of_worker,
                                  "Public sector employees" = "Public Sector",
                                  "Private sector employees" = "Private Sector")) %>% 
  ggplot(data = .,
         aes(
    x = date,
    y = value,
    fill = class_of_worker,
    text = paste0(
      "Class of Worker: ",
      class_of_worker,
      "<br>",
  "Number of Jobs:",
          signs(
            value,
            format = comma
          ),
          "<br>",
          "Month-Over-Month Change:",
          signs(
            month_change,
            format = comma,
            add_plusses = TRUE
          ),
          "<br>",
          "% Month-Over-Month Change:",
          signs(
            month_change_percent,
            format = percent,
            add_plusses = TRUE,
            accuracy = 0.1
      )
    ))) +
  geom_col(alpha = 0.6) +
  labs(x = NULL,
       y = NULL) +
  scale_y_continuous(labels = comma,
                     breaks = breaks_pretty(n = 6)) +
  scale_x_date(breaks = breaks_pretty(n = 8)) +
  scale_fill_viridis_d(name = NULL) +
  theme_minimal() +
  theme_facet_bar +
    theme(legend.text = element_text(size = 12)) 
) %>%
  layout(legend = list(
    orientation = "h",
    x = 0.25,
    y = 1.1
  ))
```


Row 3
------------------------------------------------------------------

### Number of Full-time Jobs in B.C. {.value-box}

```{r}

valueBox(
  value = paste0("Full-time: ",
                 lfc_province_tidy %>%
  filter(
    vector == "v2064702",
    date == max(date)
  ) %>%
    pull(value) %>%
    signs(format = comma)),
  # icon = "fa-users-cog",
  caption = paste("Number of Full-time Jobs in B.C. for", report_month, report_year)
)
```

### Month-Over-Month Change in Number of Full-time Jobs in B.C. {.value-box}

```{r}
valueBox(
  value = lfc_province_tidy %>%
  filter(
    vector == "v2064702",
    date == max(date)
  ) %>%
    pull(month_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    ),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in Number of Full-time Jobs in B.C."
)
```

### Year-Over-Year Change in Number of Full-time Jobs in B.C. {.value-box}

```{r}
year_change_employment_bc_ft <- lfc_province_tidy %>%
  filter(
    vector == "v2064702",
    date %in% c(max(date) - months(12), max(date))
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))

# year over year change 
valueBox(
  value = year_change_employment_bc_ft %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Full-time Jobs in B.C.")
)
```


Row 4
------------------------------------------------------------------

### Number of Part-Time Jobs in B.C. {.value-box}

```{r}
valueBox(
  value = paste0("Part-time: ",
                lfc_province_tidy %>%
  filter(
    vector == "v2064703",
    date == max(date)
  ) %>%
    pull(value) %>%
    signs(format = comma)),
  # icon = "fa-users-cog",
  caption = paste("Number of Part-time Jobs in B.C. for", report_month, report_year)
)
```

### Month-Over-Month Change in Number of Part-Time Jobs in B.C. {.value-box}

```{r}
valueBox(
  value = lfc_province_tidy %>%
  filter(
    vector == "v2064703",
    date == max(date)
  ) %>%
    pull(month_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    ),
  # icon = "fa-users-cog",
  caption = "Month-Over-Month Change in Number of Part-Time Jobs in B.C."
)
```

### Year-Over-Year Change in Number of Part-Time Jobs in B.C. {.value-box}

```{r}
year_change_employment_bc_ft <- lfc_province_tidy %>%
  filter(
    vector == "v2064703",
    date %in% c(max(date) - months(12), max(date))
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))

# year over year change 
valueBox(
  value = year_change_employment_bc_ft %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    ),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Part-Time Jobs in B.C.")
)
```



Row 5
---------------------------------------------------------------------

### Month-Over-Month Change in Number of Jobs in B.C. by Job Type in `r report_year` 

```{r, fig.width=7, fig.height=5}
ggplotly_lfs(
  lfc_province_tidy %>%
  filter(
    date >= paste0(report_year, "-01-01"),
    geo == "British Columbia",
    labour_force_characteristics %in% c("Full-time employment",
                                        "Part-time employment"),
    sex == "Both sexes",
    age_group == "15 years and over"
  ) %>%
  mutate(labour_force_characteristics = str_extract(
    labour_force_characteristics,
    "^([^,])+ "
  ), sep_out = "-") %>% {
    ggplot(data = ., 
         aes(
    x = date,
    y = month_change,
    text = paste0(
    "Number of Jobs: ",
          signs(
            value,
            format = comma
          ),
          "<br>",
          "Month-Over-Month Change: ",
          signs(
            month_change,
            format = comma,
            add_plusses = TRUE
          ),
          "<br>",
          "% Month-Over-Month Change: ",
          signs(
            month_change_percent,
            format = percent,
            add_plusses = TRUE,
            accuracy = 0.1
      )
    )
  )) +
  geom_col(fill = main_colour,
           alpha = 0.6) +
  facet_wrap(
    facets = vars(labour_force_characteristics),
    ncol = 2
    # labeller = labeller(labour_force_characteristics = label_wrap_gen(width = 10))
  ) +
  geom_text(
    aes(
      label = signs(
        month_change,
        format = comma,
        add_plusses = TRUE
      )
    ),
    nudge_y = ifelse(.$month_change > 0, 8000, -8000),
    colour = "grey20",
    size = 2.5
  ) +
  labs(x = NULL,
       y = NULL) +
  scale_y_continuous(labels = comma,
                     breaks = breaks_pretty(n = 8)) +
  scale_x_date(breaks = breaks_pretty(n = 5)) +
  theme_minimal() +
  theme_facet_bar +
  theme(panel.spacing = unit(1, "lines"))
})
```


Row 6
------------------------------------------------------------------------------

### Women Full-time Year-Over-Year Change in Number of Jobs in B.C. {.value-box}

```{r}
year_change_employment_bc_female_ft <- lfc_province_tidy %>%
  filter(
    date %in% c(max(date) - months(12), max(date)),
    geo == "British Columbia",
    labour_force_characteristics == "Full-time employment",
    sex == "Females",
   age_group == "15 years and over"
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))


# year over year change employment
valueBox(
  value = paste0("Women Full-time: ",
                 year_change_employment_bc_female_ft %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    )),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Full-time Jobs for Women (15 Years and Over) in B.C.")
)
```


### Women Part-time Year-Over-Year Change in Number of Jobs in B.C. {.value-box}

```{r}
year_change_employment_bc_female_pt <- lfc_province_tidy %>%
  filter(
    date %in% c(max(date) - months(12), max(date)),
    geo == "British Columbia",
    labour_force_characteristics == "Part-time employment",
    sex == "Females",
   age_group == "15 years and over"
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))


# year over year change employment
valueBox(
  value = paste0("Women Part-time: ",
                 year_change_employment_bc_female_pt %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    )),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Part-time Jobs for Women (15 Years and Over) in B.C.")
)
```



Row 7
------------------------------------------------------------------------------

### Change in Number of Jobs for Women in B.C. by Job Type & Age for `r report_year`

```{r}
ggplotly_lfs(
lfc_province_tidy %>%
  filter(
    date >= paste0(report_year, "-01-01"),
    geo == "British Columbia",
    labour_force_characteristics %in% c("Full-time employment",
                                        "Part-time employment"),
    sex == "Females",
   age_group %in% c(
                     "15 to 24 years",
                     "25 years and over"
                     )
  ) %>%
  mutate(labour_force_characteristics = str_extract(
    labour_force_characteristics,
    "^([^,])+ "
  ), sep_out = "-") %>% 
  ggplot(data = .,
         aes(x = date, 
             y = month_change,
              text = paste0(
                "Job Type: ",
                labour_force_characteristics,
                "<br>",
    "Number of Jobs: ",
          signs(
            value,
            format = comma
          ),
          "<br>",
          "Month-Over-Month Change: ",
          signs(
            month_change,
            format = comma,
            add_plusses = TRUE
          ),
          "<br>",
          "% Month-Over-Month Change: ",
          signs(
            month_change_percent,
            format = percent,
            add_plusses = TRUE,
            accuracy = 0.1
      )
    ))) +
  geom_col(aes(fill = labour_force_characteristics),
           alpha = 0.6) +
facet_grid(. ~ age_group) +
  labs(x = NULL,
       y = NULL) +
  scale_y_continuous(labels = comma,
                     breaks = breaks_pretty(n = 8)) +
  scale_x_date(breaks = breaks_pretty(n = 5)) +
   scale_fill_viridis_d(name = NULL) +
  theme_minimal() +
  theme_facet_bar +
  theme(panel.spacing = unit(1, "lines"))
) %>%
  layout(legend = list(
    orientation = "h",
    x = 0.32,
    y = -0.2
  ))
```

Row 8
------------------------------------------------------------------------------

### Men Full-time Year-Over-Year Change in Number of Jobs (15 Years and Over) in B.C. {.value-box}

```{r}
year_change_employment_bc_male_ft <- lfc_province_tidy %>%
  filter(
    date %in% c(max(date) - months(12), max(date)),
    geo == "British Columbia",
    labour_force_characteristics == "Full-time employment",
    sex == "Males",
   age_group == "15 years and over"
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))


# year over year change employment
valueBox(
  value = paste0("Men Full-time: ",
                 year_change_employment_bc_male_ft %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    )),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Full-time Jobs for Men (15 Years and Over) in B.C.")
)
```


### Men Part-time Year-Over-Year Change in Number of Jobs (15 Years and Over) in B.C. {.value-box}

```{r}
year_change_employment_bc_male_pt <- lfc_province_tidy %>%
  filter(
    date %in% c(max(date) - months(12), max(date)),
    geo == "British Columbia",
    labour_force_characteristics == "Part-time employment",
    sex == "Males",
   age_group == "15 years and over"
  ) %>%
  mutate(
    year_change = value - lag(value),
    year_change_percent = value / lag(value) - 1
  ) %>%
  filter(date == max(date))


# year over year change employment
valueBox(
  value = paste0("Men Part-time: ",
                 year_change_employment_bc_male_pt %>%
    pull(year_change) %>%
    signs(
      format = comma,
      add_plusses = TRUE
    )),
  # icon = "fa-users-cog",
  caption = paste("Year-Over-Year Change in Number of Part-time Jobs for Men (15 Years and Over) in B.C.")
)
```



Row 9
------------------------------------------------------------------------------

### Change in Number of Jobs for Men in B.C. by Job Type & Age for `r report_year`

```{r}
ggplotly_lfs(
lfc_province_tidy %>%
  filter(
    date >= paste0(report_year, "-01-01"),
    geo == "British Columbia",
    labour_force_characteristics %in% c("Full-time employment",
                                        "Part-time employment"),
    sex == "Males",
   age_group %in% c(
                     "15 to 24 years",
                     "25 years and over"
                     )
  ) %>%
  mutate(labour_force_characteristics = str_extract(
    labour_force_characteristics,
    "^([^,])+ "
  ), sep_out = "-") %>% 
  ggplot(data = .,
         aes(x = date, 
             y = month_change,
              text = paste0(
                "Job Type: ",
                labour_force_characteristics,
                "<br>",
    "Number of Jobs: ",
          signs(
            value,
            format = comma
          ),
          "<br>",
          "Month-Over-Month Change: ",
          signs(
            month_change,
            format = comma,
            add_plusses = TRUE
          ),
          "<br>",
          "% Month-Over-Month Change: ",
          signs(
            month_change_percent,
            format = percent,
            add_plusses = TRUE,
            accuracy = 0.1
      )
    ))) +
  geom_col(aes(fill = labour_force_characteristics),
           alpha = 0.6) +
facet_grid(. ~ age_group) +
  labs(x = NULL,
       y = NULL) +
  scale_y_continuous(labels = comma,
                     breaks = breaks_pretty(n = 8)) +
  scale_x_date(breaks = breaks_pretty(n = 5)) +
   scale_fill_viridis_d(name = NULL) +
  theme_minimal() +
  theme_facet_bar +
  theme(panel.spacing = unit(1, "lines"))
) %>%
  layout(legend = list(
    orientation = "h",
    x = 0.32,
    y = -0.2
  ))
```


Industry
====================================================================

Row 1
-----------------------------------------------------------------------

Row 2
-----------------------------------------------------------------------


COVID-19 Recovery
======================================================================


About {data-orientation=columns}
======================================================================


Column
-----------------------------------------------------------------------

Data are sourced from the [Statistics Canada Labour Force Survey (LFS)](https://www.statcan.gc.ca/eng/survey/household/3701), a monthly survey which measures the current state of the Canadian labour market. 
  
Statistics Canada data are released under the [Statistics Canada Open Licence](https://www.statcan.gc.ca/eng/reference/licence).
  
Statistics Canada Labour Force Survey Tables: 

 - [Statistics Canada Table **14-10-0287-03**: Labour force characteristics by province, monthly, seasonally adjusted](https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1410028703)
 - [Statistics Canada Table **14-10-0293-02**: Labour force characteristics by economic region, three-month moving average, unadjusted for seasonality](https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1410029302)
 - [Statistics Canada Table **14-10-0288-01**: Employment by class of worker, monthly, seasonally adjusted and unadjusted, last 5 months](https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1410028801) 
 
 <!--
 - [Statistics Canada Table **14-10-0127-01**: Reason for not looking for work, monthly, unadjusted for seasonality](https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1410012701&pickMembers%5B0%5D=1.11&pickMembers%5B1%5D=3.1&pickMembers%5B2%5D=4.1) 
 -->
 
B.C. Data Catalogue:
 - [Current Census Economic Regions](https://catalogue.data.gov.bc.ca/dataset/1aebc451-a41c-496f-8b18-6f414cde93b7)

This report is built with the [`flexdashboard` R package](https://rmarkdown.rstudio.com/flexdashboard/), sourcing the Statistics Canada Labour Force Survey data using the [`cansim` R package](https://mountainmath.github.io/cansim/index.html), and the British Columbia economic geospatial data using the [`bcdata` R package](https://bcgov.github.io/bcdata/). 
  
The [R](https://www.r-project.org/) code is available in [bcgov GitHub](https://github.com/bcgov/labour-force-survey-digest), made available under the [Apache 2.0 licence](https://github.com/bcgov/labour-force-survey-digest/blob/master/LICENSE).
